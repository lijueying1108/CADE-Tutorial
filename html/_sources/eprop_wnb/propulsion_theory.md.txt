# Propulsion System
---
## Background and Introduction

The propulsion system can vary depending on the requirements and vehicle type. The UAV in Fig. 01 utilizes a propulsion system suitable for small aircraft and UAVs characterized by BLDC (Brushless DC) motors combined with fixed-pitch propellers. The BLDC motors are known for their high efficiency, reliability, and power-to-weight ratio, making them ideal for UAV applications with critical performance and battery life. The fixed-pitch propellers, as opposed to variable-pitch ones, have a constant blade angle, simplifying the design and reducing mechanical complexity. This combination allows for stable and efficient thrust generation, suitable for the precise and consistent control required in various UAV operations, including aerial photography, surveillance, and recreational flying. The system is optimized to balance lift and maneuverability, ensuring smooth flight dynamics and responsive control.

<figure style="text-align: center;">
  <img src="figures/propeller-uav.png">
  <figcaption>Fig. 01: UAV Propulsion System</figcaption>
</figure>

The propulsion system of the UAV, as depicted in Figure 2, comprises a Brushless Direct Current (BLDC) motor. The motor, as shown in Fig. 03, receives electrical power from the battery. The battery supplies DC power to the motor, which a controller regulates. This controller manages the speed and rotational direction of the BLDC motor by adjusting the electrical input, thereby controlling the motor's speed, i.e., Revolutions Per Minute (RPM). The motor, in turn, drives the fixed-pitch propeller. As the propeller rotates at varying speeds, it produces the necessary thrust to lift and maneuver the UAV. The fixed-pitch design of the propeller means that the blade angle is fixed, simplifying the mechanical aspects of the system while relying on the RPM adjustments to control the thrust and, consequently, the flight dynamics of the UAV. This integration of battery, controller, motor, and propeller ensures efficient and responsive propulsion, which is critical for the UAV's performance and operational capabilities.

<figure style="text-align: center;">
  <img src="figures/prop-uav.png">
  <figcaption>Fig. 02: UAV Propulsion System</figcaption>
</figure>

<figure style="text-align: center;">
  <img src="figures/bldc_motor.png">
  <figcaption>Fig. 03: BLDC Motor</figcaption>
</figure>

The propulsion system for a typical Urban Air Mobility (UAM) vehicle is shown in Fig. 04. The system starts with a battery that supplies DC power. A converter converts this DC power to a suitable voltage level before feeding it to an inverter. The inverter's role is to transform the DC into Alternating Current (AC) power, which the motor requires. A controller oversees this process, adjusting the inverter's output through a control signal to manage the duty cycle and ensure the motor operates correctly. The controller also receives feedback from the motor to make real-time adjustments, optimizing performance and efficiency. The motor, driven by AC power, generates torque transmitted through a gearbox (if needed). The gearbox adjusts the motor's torque and RPM to the optimal levels for the propeller. The propeller, driven by the adjusted RPM and torque, creates the necessary thrust to lift and propel the UAM vehicle. This complex integration of battery, converter, inverter, motor, gearbox, and propeller, all managed by a controller, ensures the UAM system operates with high efficiency, precision, and reliability, which are vital for the demands of urban air transportation.

<figure style="text-align: center;">
  <img src="figures/prop-uam.png">
  <figcaption>Fig. 04: UAM Propulsion System</figcaption>
</figure>


Fig. 05 illustrates an all-electric Distributed Electric Propulsion (DEP) system designed for efficient and reliable operation in electric aircraft. The DC power from the battery is distributed to multiple propulsion units, each consisting of a converter, an inverter, and a motor connected to a propeller. The DEP system distributes the propulsion power across multiple units, which can improve efficiency, redundancy, and control. This design allows for more precise thrust management and can enhance the aircraft's safety and performance by providing multiple propulsion sources. If one unit fails, the others can continue to operate, ensuring continued flight capabilities. This setup is especially beneficial for electric aircraft, where maximizing efficiency and reliability is crucial.

<figure style="text-align: center;">
  <img src="figures/prop-all-electric.png">
  <figcaption>Fig. 05: UAM Propulsion System</figcaption>
</figure>


| Electrical Component   | Generator | Rectifier | Electrical Bus | Inverter | Motor | Total Efficiency |
|------------------------|-----------|-----------|----------------|----------|-------|------------------|
| Electrical efficiency  | 95%       | 95%       | 99%            | 95%      | 95%   | 80.6%            |

**Table 1: Electrical Component Efficiency**

Fig. 06 showcases a propulsion system for UAM or Regional Air Mobility (RAM) applications, utilizing an Axial Flux Permanent Magnet (AXIPM) motor coupled with a variable pitch propeller. This type of motor features an axial flux design (as illustrated in Fig. 07), typically providing a high power-to-weight ratio and efficient energy conversion. It is well-suited for aviation applications where space and weight are critical considerations. The permanent magnet configuration enhances the motor's efficiency and performance.

<figure style="text-align: center;">
  <img src="figures/propeller-uam.png">
  <figcaption>Fig. 06: Variable pitch propeller</figcaption>
</figure>
<figure style="text-align: center;">
  <img src="figures/motor_axial_radial.png">
  <figcaption>Fig. 07: Radial and Axial flux PMSM motor</figcaption>
</figure>

This combination of an AXIPM motor with a variable pitch propeller provides several advantages for UAM/RAM vehicles. The high efficiency and power density of the AXIPM motor and the adaptability of the variable pitch propeller ensure that the propulsion system can deliver the necessary thrust with optimal efficiency and control. This setup is particularly beneficial in urban and regional air mobility contexts, where varying flight conditions and the need for precise maneuverability are common.

For a typical case, Fig. 08 shows the performance data and plots obtained from the manufacturer's website of EMRAX 348, a high-performance electric motor for various applications, including aviation, automotive, and industrial uses. The motor can deliver a peak power of 400 kW and a peak torque of 1000 Nm. This level of performance is typically used for short bursts, such as takeoff in aviation or acceleration in automotive applications. The performance graph indicates peak power and peak torque at higher RPM ranges. The motor achieves its peak power of around 4000 RPM, where the torque decreases. The efficiency map shows the motor's efficiency across different speeds and torque levels. The highest efficiency regions (94\%-96\%) are found at moderate speeds and torque values, indicating optimal operating conditions for continuous usage.

The motor's continuous power rating is 210 kW with a continuous torque of 500 Nm, suitable for sustained operations without overheating. These values ensure that the motor runs efficiently for prolonged periods, maintaining high performance without significant thermal buildup.

Such motors stand out due to their high-power density, efficiency, and versatility. Whether for aviation, automotive, or industrial applications, it offers a robust solution that delivers peak performance and sustained efficiency. The detailed performance graphs and efficiency maps provide valuable insights for optimizing its use across various scenarios.

<figure style="text-align: center;">
  <img src="figures/motor_01.png">
  <figcaption>Fig. 08: EMRAX 348 Axial Flux Motor</figcaption>
</figure>


Unlike fixed-pitch propellers, variable-pitch propellers allow the angle of the blades to be adjusted. This adjustment capability enables optimization of thrust and efficiency across different phases of flight, such as takeoff, cruising, and landing. The propeller can maintain optimal aerodynamic efficiency, as illustrated in Fig. 09, by varying the pitch, improving overall performance and fuel efficiency.

<figure style="text-align: center;">
  <img src="figures/peak_eff.png">
  <figcaption>Fig. 09: Propeller efficiencies with varying pitch</figcaption>
</figure>


## Propeller Model
The propeller performance is estimated using a physics-based approach, viz., Blade Element Momentum Theory. We now provide a brief description of the approach.

### Introduction to Blade Element Momentum Theory (BEMT):
Blade Element Momentum Theory (BEMT) is a fundamental method used in aerodynamics and propeller analysis to predict the performance of propellers, wind turbines, and other rotary wings. It combines the principles of blade element theory and momentum theory to provide a comprehensive understanding of the forces and moments acting on each blade of a propeller. BEMT is widely used due to its balance between accuracy and computational efficiency, making it suitable for preliminary design and detailed performance analysis.

#### Blade Element Theory (BET):

Blade Element Theory divides the propeller blade into small, discrete elements along its span. Each blade element is analyzed independently to determine the local aerodynamic forces acting on it. The key steps include:
- Dividing the Blade: The blade is segmented into several small elements, each with its own local chord length, twist angle, and airfoil properties.
- Calculating Local Forces: For each blade element, the lift and drag forces are calculated based on the local angle of attack and relative wind speed. These forces are resolved into thrust and torque components.

#### Momentum Theory:
Momentum Theory applies mass and momentum conservation principles to the airflow through the propeller disk. It considers the propeller an actuator disk that imparts momentum to the air, resulting in thrust. The key aspects include:
- Axial Momentum: The change in axial momentum of the airflow is used to determine the thrust generated by the propeller.
- Angular Momentum: The change in angular momentum is used to calculate the torque required to rotate the propeller.

#### Combining BET and Momentum Theory:
BEMT combines the local blade element forces with the overall momentum changes to provide a complete picture of the propeller's performance. The integration process involves:
- Iterative Process: An iterative approach matches the local inflow angles and induced velocities predicted by momentum theory with those calculated from blade element theory.
- Induced Velocity Correction: The theory accounts for the induced velocity (downwash) caused by the propeller, which affects the angle of attack and, consequently, the lift and drag forces on each blade element.

#### Performance Prediction:
By integrating the forces and moments across all blade elements, BEMT provides critical performance parameters of the propeller, such as:
- **Thrust**: The total axial force generated by the propeller.
- **Torque**: The total rotational force required to drive the propeller.
- **Efficiency**: The ratio of useful power output (thrust power) to mechanical power input.

The mathematical formulation of the vanilla version of BEMT can be found in a standard wind turbine propeller/propulsion textbook. Based on the formulation, we can write our code.  Several proprietaries and open-source codes and software are available based on the above theory, which can also be used.


We have developed an in-house propeller analysis code based on blade element momentum theory (BEMT), which combined blade element theory with momentum theory. We incorporate suggested techniques in our code to improve its accuracy and robustness. In the next section, we detail the mathematical modeling of these theories, along with the methods employed for these improvements.

### Mathematical Formulation of Blade Element Theory:
---
This approach involves the blade element analysis, where the propeller blade is divided into numerous sections. For each section, lift and drag forces are calculated based on their unique airfoil characteristics and the prevailing operational conditions, similar to the force dynamics on an aircraft wing. These forces are then resolved along the propeller's axis, as depicted in Figure~\ref{bem}, to determine the propeller's resultant thrust and torque.

**Blade Element Theory:** This approach involves the blade element
analysis, where the propeller blade is divided into numerous sections.
For each section, lift and drag forces are calculated based on their
unique airfoil characteristics and the prevailing operational
conditions, similar to the force dynamics on an aircraft wing. These
forces are then resolved along the propeller's axis, as depicted in
Fig. 10, to determine
the propeller's resultant thrust and torque.

<figure style="text-align: center;">
  <img src="figures/bem.png">
  <figcaption>Fig. 10: Propeller analysis using blade element model</figcaption>
</figure>

The forces generated by an elemental blade section are mathematically
represented as axial force ($dT$) and angular force ($dQ$). These
forces, acting in a plane perpendicular to the blade, are derived from
the differential lift ($dL$) and drag ($dD$) forces, considering the
inflow angle ($\phi$):

$$\begin{aligned}
    dT = &~dL \cos\phi - dD \sin\phi \\
    dQ = &~dL \sin\phi + dD \cos\phi
\end{aligned}$$

We further express them in terms of the local resultant wind speed
($V_R$), chord length ($c_r$), air density ($\rho$), and aerodynamic
coefficients $C_l$ and $C_d$:

$$\begin{aligned}
    dT = &~\frac{1}{2} \rho V_R^2 c_r dr \left[ C_l(\alpha) \cos \phi - C_d(\alpha) \sin \phi \right] \\
    dQ = &~\frac{1}{2} \rho V_R^2 c_r dr \left[ C_l(\alpha) \sin \phi + C_d(\alpha) \cos \phi \right]
\end{aligned}$$

$V_R$ and $\phi$ are calculated using the free stream velocity
($V_{\infty}$), rotational speed ($\Omega$), and the axial and angular
induction factors ($a$ and $a^{\prime}$):

$$V_R = \sqrt{\left[V_{\infty}(1+a)\right]^2 + \left[\Omega r\left(1-a^{\prime}\right)\right]^2}
    $$

$$\phi = \tan^{-1}\left[\frac{V_{\infty}(1+a)}{\Omega r\left(1-a^{\prime}\right)}\right]$$

The differential thrust ($dT$) and torque ($d\tau$) are computed as
follows:

$$\begin{aligned}
    dT = \sigma_{r} \frac{(1+a)^2}{\sin^2 \phi}\left[C_l(\alpha) \cos \phi - C_d(\alpha) \sin \phi\right] V_{\infty}^2 \rho \pi r dr \\
    d\tau = \sigma_{r} \frac{(1+a)^2}{\sin^2 \phi}\left[C_l(\alpha) \sin \phi + C_d(\alpha) \cos \phi\right] V_{\infty}^2 \rho \pi r^2 dr \
\end{aligned}$$

Here, $\sigma_{r} = \frac{B c_{r}}{2 \pi r}$ represents the blade
solidity, with $B$ being the number of propeller blades.

The thrust and torque now can be obtained once we know $V_r$, $C_l$, and
$C_d$. We know from Equation [\[vr\]](#vr) that $V_R$ estimation requires $a$ and $a^{\prime}$.
Therefore, we combine the momentum theory described in the following
section to get the induced velocity.

**Momentum Theory:** Momentum theory is based on conceptualizing the
propeller as an actuator disk. This idealization represents the
propeller as an infinitely thin disk that induces a minor velocity
increment ($u$) in the flow direction.
Fig. 11 provides a
clear representation of the actuator disk model in the context of
propeller analysis.

<figure style="text-align: center;">
  <img src="figures/disk.png">
  <figcaption>Fig. 11: Propeller analysis using momentum theory</figcaption>
</figure>

The analysis assumes that energy states before and after the propeller
remain conserved. Applying Bernoulli's theorem, we can express the
pressure difference across the actuator disk as:

$$\Delta p = \frac{1}{2} \rho V_{\infty}^2 4a(1 + a)$$

Here, $\Delta p$ represents the pressure difference, $\rho$ is the air
density, and $a$ is the axial induction factor, quantifying the velocity
increment induced by the propeller.

Considering this pressure difference over a small area $dA = 2\pi r dr$
of the disk, the incremental thrust $dT$ is derived:

$$dT = \frac{1}{2}\rho V_{\infty}^2 4a(1 + a)(2\pi r dr)
    $$

This equation calculates the differential thrust, with $r$ denoting the
radial position on the disk.

For the propeller's rotational effects, the incremental torque ($d\tau$)
is linked to the change in angular momentum for an elemental annulus of
the disk:

$$d\tau = \rho\left( 2\pi r dr\right) V_d r^2\omega$$

The angular induction factor, $a^{\prime}$, relates to the induced
angular velocity ($\omega$) and the propeller disk's angular velocity
($\Omega$):

$$a^{\prime} = \frac{\omega}{2\Omega}$$

The induced velocity ($V_d$) through the disk, influenced by $a$, is:

$$V_d = V_{\infty}(1+a)$$

Integrating the incremental torque over the entire disk yields the total
torque:

$$d\tau = 2 a^{\prime} (1+a)\rho V_{\infty} \Omega r^3 \pi dr
    $$

To enhance the accuracy of momentum theory, we incorporate corrections
as suggested by @Glauert1935, aligning theoretical predictions with
empirical data. The tip loss correction factor ($\mathcal{F}_{T}$),
addressing lift loss at the propeller's tips due to air pressure
differences, is calculated as follows:

$$\mathcal{F}_{T}=\frac{2}{\pi}\cos^{-1}\left[e^{-{\frac{B}{2}\left(\frac{R-r}{r |{\sin\phi}|}\right)}}\right]$$
Similarly, the hub loss correction factor ($\mathcal{F}_{H}$) accounts
for lift loss near the propeller hub:
$$\mathcal{F}_{H}=\frac{2}{\pi}\cos^{-1}\left[e^{-{\frac{B}{2}\left(\frac{r - R_{H}}{R_{H} |{\sin\phi}|}\right)}}\right]$$
The combined effect, $\mathcal{F} = \mathcal{F}_{T}\mathcal{F}_{H}$, is
applied to the disk loading equations
(Equations [\[disk_thrust\]](#disk_thrust) and
[\[disk_torque\]](#disk_torque)) to align with Blade Element Momentum (BEM)
theory solutions
(Equations [\[bem_thrust\]](#bem_thrust) and
[\[bem_torque\]](#bem_torque)). This yields:
$$\begin{aligned}
    & \frac{a}{1+a}=\frac{\sigma_r \left[C_l \cos \phi - C_d \sin \phi\right]}{4 \mathcal{F} \sin ^2 \phi} \\
    & \frac{a^{\prime}}{1+a}=\frac{\sigma_r\left[C_l \sin \phi + C_d \cos \phi\right]}{4 \mathcal{F} \lambda_r \sin ^2 \phi}
\end{aligned}$$
where $\lambda_r$ is the tip speed ratio, which is
represented by $\frac{\Omega r}{V_{\infty}}$.

We utilize XFOIL for pre-stall aerodynamic
coefficients estimation and the Viterna method
for post-stall extrapolation:

$$C_l=\frac{C_{d_{max}}}{2} \sin 2 \alpha+k_l \frac{\cos ^2 \alpha}{\sin \alpha}$$
where $C_{d_{max}}$ is the drag coefficient at the angle of attack of 90
degrees. $k_l$ represents a correction factor for lift, calculated based
on the stall coefficients. Similarly, the drag coefficient is given by:
$$C_d= C_{d_{max}}\sin ^2 \alpha+k_d \cos \alpha$$

For finite aspect ratio blades, $C_{d_{max}}$ varies based on aspect
ratio ($AR$):
$$
C_{d_{max}}= \begin{cases}
    1.11 + 0.018 \, AR, & \text{if } AR \leq 50 \\
    2.01, & \text{otherwise}
\end{cases}
$$
 The coefficients $k_l$ and $k_d$ are calculated using
stall coefficients:
$$k_l=\left(C_{l_s}-C_{d_{max}} \sin \alpha_s \cos \alpha_s\right) \frac{\sin \alpha_s}{\cos ^2 \alpha_s}$$
$$k_d=\frac{C_{d_s}-C_{d_{max}} \sin ^2 \alpha_s}{\cos \alpha_s}$$

To quickly predict $C_l$ and $C_d$ across various $Re$ and angles of
attack, we have developed a kriging-based surrogate model and coupled it
to the propeller model. Once the values of $a$ and $a^\prime$ are
determined, $T$ and $\tau$ can be estimated by summing $dT$ and $d\tau$
across the entire blade, respectively. We get the thrust coefficient
($C_T$) as:

$$C_T=\frac{T}{\rho n^2 D^4}$$

Here, $n$ represents the
propeller speed in rotations per second, and $D$ denotes the propeller
diameter. We calculate the power coefficient ($C_P$) as:

$$C_P= \frac{P}{\rho n^3 D^5}$$

P is the power we get from
$2\pi n \tau$. We get the efficiency ($\eta$) as:

$$\eta= J\frac{C_T}{C_P}$$

where $J= \frac{V}{n D}$, is the advance
ratio. The following section briefly discusses the validation study
conducted for the motor and propeller model.

## Model Validation

This section discusses the validation studies of the motor and propeller
models.

### Motor Performance Validation

We conduct a validation of our motor model against the EMRAX 208, an axial flux motor shown in Fig. 11 renowned for its
compact and efficient design, making it ideal for electric aircraft
applications.

<figure style="text-align: center;">
  <img src="figures/emrax_208.png">
  <figcaption>Fig. 11: EMRAX 208 Motor</figcaption>
</figure>

Table 01 lists
the corresponding key motor parameters. This validation process is
crucial to ensuring that our motor model accurately reflects the
performance characteristics of the EMRAX 208, thereby confirming its
suitability for integration into the propulsion system of our electric
aircraft design.


**Parameters**               | **Values**
-----------------------------|------------
Continuous Power (${P}_{\mathrm{cont}}$), [kW] | 25-40
Peak Power (${P}_{\mathrm{peak}}$), [kW] | 80
Continuous Torque (${Q}_{\mathrm{cont}}$), [N.m] | 80
Peak Torque (${Q}_{\text{peak}}$), [N.m] | 150
Continuous Current (${I}_{\mathrm{cont}}$), [A] | 100
Peak Current (${I}_{\text{peak}}$), [A] | 200
Rated Speed (${ \omega }_{ \mathrm{rated} }$), [RPM] | 4500
Maximum Speed (${ \omega }_{ \mathrm{max} }$), [RPM] | 6000
Torque Constant (${ K }_{ \mathrm{t} }$), [N.m/A] | 0.83
Poles (${ n_{pole} }$), [-] | 20
Resistance (${ R_s }$), [m omega] | 125
Inductance (${ L_s }$), [mu H] | 130
Flux Linkage (${ \psi }_{ \mathrm{m} }$), [Vs] | 0.0393
Back EMF (${ K }_{ \mathrm{e} }$), [Vs/rad] | 15

*Table 01: EMRAX 208HC CC PMSM Parameters*


Fig. 12
illustrates the EMRAX 208 motor's performance, showcasing peak power and
torque over varying speeds. The motor operates efficiently within its
Maximum Torque per Ampere (MTPA) range and Flux-weakening (FW) regimes
for optimal power. Manufacturer data are plotted
alongside our model's performance curves. Notably, peak torque (orange)
diminishes with increasing speed, while peak power (blue) rises to a
plateau. Power loss (green) escalates with speed. The close alignment
between the model and empirical data assures that the model is
acceptable for our use case.


<figure style="text-align: center;">
  <img src="figures/motor_valid_emrax208.png">
  <figcaption>Fig. 12: Peak power, torque, power loss validated with EMRAX manufacturer's
data</figcaption>
</figure>

## Motor
---
#### Motor Modeling

Electric motors are an integral part of electric aircrafts. They are
responsible for converting electrical energy into mechanical energy,
providing propulsive force necessary for flight. UAM aircraft while
going through various flight phases, require motors that can deliver
high torque within a confined speed range. This is distinct from the
automotive industry's focus on high-speed motors for electric vehicles
(EVs).

For our eVTOL aircraft propulsion, we've chosen Permanent Magnet
Synchronous Motors (PMSMs) over Brushless DC Motors (BLDC) due to their
superior compactness, high torque density and rapid
response to load changes, Tessential for eVTOL's varying
flight demands. PMSMs offer greater efficiency, lower noise, and
improved power density, despite their higher cost and complex control
requirements. These features make
PMSMs the optimal choice for achieving the performance goals of our
eVTOL aircraft design, ensuring it meets the high standards required for
efficient and effective propulsion.

Fig. 13 represents a simplified equivalent circuit
model of a PMSM. The stator resistance $R_s$ and synchronous inductance
$L_s$ are parameters obtained from motor manufacturers. For analyzing
the motor's performance, phasor analysis within the d-q reference frame
is employed. The rotor's magnetic
field establishes the d-axis as the reference axis.

<figure style="text-align: center;">
  <img src="figures/motor_circuit.png">
  <figcaption>Fig. 13: Phase-wise equivalent circuit of a
PMSM</figcaption>
</figure>

The back electromotive force $E_{\phi,mot(q)}$ in the motor is
calculated using:

$$E_{\phi,mot(q)} = K_e \cdot \omega_{rotor} = \frac{\omega_{rotor}}{K_v}$$

where $\omega_{rotor}$ represents the rotor speed, $K_e$ is the back EMF
constant ($V s / rad$), and $K_v$ is the motor constant provided by the
manufacturer ($rpm / V$).

The no-load torque ($Q_{nl}$) and the electromechanical torque
($Q_{em}$) are determined by the following equations:

$$Q_{nl} = \frac{P_{\mathrm{mech}}}{\omega_{\mathrm{rotor}}}$$

$$Q_{em} = Q_{rotor} + Q_{nl}$$

where $P_{\mathrm{mech}}$ is the
mechanical power loss of the motor and $Q_{rotor}$ is the load torque
from the propeller.

When field weakening is not applied ($I_{\phi,mot(d)} = 0$), the
magnitude of the phase current is estimated as:

$$|I_{\phi,mot}| = I_{\phi,mot(q)} = \frac{Q_{em}}{3 \cdot K_e} = \frac{Q_{em} \cdot K_v}{3}$$

The components of the d-axis and q-axis voltages are described as:

$$V_{\phi,mot(d)} = -\omega_{rotor} \cdot n_{pp} \cdot L_s \cdot I_{ph,mot(q)}$$
$$V_{\phi,mot(q)} = E_{\phi,mot(q)} + R_s \cdot I_{\phi,mot(q)}$$

The phase voltage magnitude is then calculated by:
$$|V_{\phi,mot}| = \sqrt{V_{\phi,mot(d)}^2 + V_{\phi,mot(q)}^2}$$

The total power loss ($P_{loss}$) and input power ($P_{in,mot}$) are
given by:
$$P_{loss} = P_{cu} + P_{mech}$$
$$P_{in,mot} = P_{loss} + Q_{rotor} \cdot \omega_{rotor}$$

The modulation index ($m_a$) is defined as:

$$m_a = 2\sqrt{2} \cdot \frac{|V_{\phi,mot}|}{V_{DC}}$$ 

where $V_{DC}$
is the DC bus voltage.

In our study, mechanical losses like windage, friction, and stray
losses, which generally account for a minor portion of total power
losses, were deemed negligible in line with existing literature. Consequently, we equated
mechanical losses to copper losses when assessing efficiency. Our
analysis focused on copper losses due to their substantial role in total
losses, as highlighted in previous research.
$$P_{cu} = 3 \cdot R_s \cdot |I_{\phi,mot}|^2$$



## Inverter
---
### Inverter Modeling
A three-phase inverter is used to convert DC into AC for powering a
Permanent Magnet Synchronous Motor (PMSM). In our analysis, we focus on
the efficiency of this inverter, which employs Gallium Nitride (GaN)
Metal-Oxide-Semiconductor Field-Effect Transistors (MOSFETs).
GaN-MOSFETs are recognized for their high efficiency, largely due to
their low on-state resistance and higher switching speed. These properties enable the development of smaller
and lighter inverters, essential in aerospace applications. Despite
their relatively recent emergence, the rapid advancements in GaN
technology make them a
promising choice.

A critical factor in inverter efficiency is the conduction losses of
GaN-MOSFETs, which constitute a significant portion of total power
losses. We simplify the assessment by focusing on conduction losses and
omitting switching losses, which are generally low for GaN devices. The
conduction losses are quantified using the phase current
($I_{\phi,inv}$) and the MOSFET's on-state resistance ($R_{ds(on)}$).
Additionally, the modulation index ($m_a$) and the phase angle ($\phi$)
are crucial to the calculation, representing the inverter's operating
conditions and the power factor of the load, respectively.

$$P_{\mathrm{M,inv}} = I_{\mathrm{\phi,inv}}^2 \cdot R_{\mathrm{ds(on)}} \cdot \left(\frac{1}{8} + \frac{m_a \cdot \cos(\phi)}{8}\right)$$

$$\begin{aligned}
    P_{\mathrm{D,inv}} = & I_{\mathrm{\phi,inv}} \cdot V_{\mathrm{fw}} \cdot \left(\frac{1}{2\pi} - \frac{m_a \cdot \cos(\phi)}{8}\right) \nonumber \\
    & + I_{\mathrm{\phi,inv}}^2 \left(\frac{1}{8} - \frac{m_a \cdot \cos(\phi)}{3\pi}\right) \cdot R_{\mathrm{d}}
\end{aligned}$$

The total conduction losses within the inverter are obtained by summing
the losses from the MOSFETs and diodes:

$$P_{\mathrm{loss,inv}} = 6 \cdot (P_{\mathrm{M,inv}} + P_{\mathrm{D,inv}})$$

Subsequently, the input power and current to the inverter
($I_{\mathrm{in,inv}}$) can be determined to provide insight into the
overall efficiency of the power conversion process:

$$P_{\mathrm{in,inv}} = P_{\mathrm{loss,inv}} + P_{\mathrm{out,inv}}$$

$$I_{\mathrm{in,inv}} = \frac{P_{\mathrm{in,inv}}}{V_{\mathrm{DC}}}$$

This analytical approach enables the quick estimate of the inverter's
efficiency. In the next section we describe the motor modeling.

### Converter

#### Converter Model

A DC-DC converter is an integral component in power supply applications,
serving to adapt the voltage level of a DC source to meet the
requirements of various devices. Such converters are pivotal in managing
energy flow in systems where source and load voltages differ. They are
commonly utilized for voltage regulation in energy storage systems and
portable electronic devices, among other applications. This
study focuses on buck converters due to their relevance in electric
propulsion systems, particularly in eVTOLs. High-voltage batteries or
fuel cells employed in eVTOLs necessitate buck converters to step down
the voltage to suitable levels for motors, avionics, and other electric
devices.

The efficiency of a buck converter is a critical aspect directly
influenced by the power losses occurring within its components, namely
the MOSFET, diode, and inductors. These losses are quantified using the
ensuing equations:

$$D = \frac{V_{\mathrm{in,conv}}}{V_{\mathrm{out,conv}}}
    \label{equation:dutycycle}$$
where $D$ represents the duty cycle of
the converter, a unitless parameter that determines the output voltage
($V_{\mathrm{out,conv}}$) and ($V_{\mathrm{in,conv}}$) is the input
voltage. The duty cycle is instrumental in calculating the power losses
in both the MOSFET and the diode, which can be determined using
Equations below:

$$P_{\mathrm{M,conv}} = I_{\mathrm{out,conv}}^2 \cdot R_{\mathrm{ds(on)}} \cdot D
   $$

$$P_{\mathrm{D,conv}} = I_{\mathrm{out,conv}} \cdot (1-D) \cdot V_{\mathrm{fw}} + I_{\mathrm{out,conv}}^2 \cdot (1-D) \cdot R_{\mathrm{d}}$$

Inductor losses can be calculated from the output current
($I_{\mathrm{out,conv}}$) and inductance of the converter
($R_{\mathrm{L}}$):

$$P_{\mathrm{L,conv}} = I_{\mathrm{out,conv}}^2 \cdot R_{\mathrm{L}}$$

The cumulative loss within the converter aggregates the losses from the
MOSFET, diode, and inductor components:
$$P_{\mathrm{losses,conv}} = P_{\mathrm{M,conv}} + P_{\mathrm{D,conv}} + P_{\mathrm{L,conv}}
    \label{equation:converterloss}$$ 
Finally, the input current
($I_{\mathrm{in,conv}}$) to the converter is computed as the quotient of
the input power and the input voltage:
$$I_{\mathrm{in,conv}} = \frac{P_{\mathrm{out,conv}}+P_{\mathrm{loss,conv}}}{V_{\mathrm{in,conv}}}$$
It is essential to account for all types of losses to ensure the
accurate prediction of the converter's performance. These losses
directly impact the efficiency and thermal management of the converter,
which are crucial for the reliable operation of eVTOLs.

### Battery
---
#### Battery Model

Accurate State of Charge (SoC) estimation is crucial for estimating
aircraft performance. Various battery models have been discussed in
literature, each with its own merits. Electrochemical mechanism models
are highly accurate but complex, making them more suitable for battery
design and manufacturing. Data-driven models, especially those based on
neural networks, require extensive training data, leading to higher
computational costs. 

Equivalent Circuit Model (ECM)-based models offer an optimal balance
between complexity and accuracy, making them preferred choices for
real-world applications. While
Thevenin and other battery models provide higher accuracy, around
$\pm$ 1%, our
framework utilizes a modified version of the ECM, depicted in
Fig. 14. This
model is selected for its speed, robustness, and reasonable accuracy
. It simplifies the parameterization process
using inputs derived from discharge characteristics or manufacturer data
and is adaptable to a variety of battery chemistries and configurations.
The modular nature of our framework also allows for easy integration of
alternative models, offering the flexibility needed to adapt to
different scenarios.

<figure style="text-align: center;">
  <img src="figures/battery.png">
  <figcaption>Fig. 14: Battery model equivalent circuit
diagram
</figcaption>
</figure>

Fig. 15 presents the typical discharge curve of a
Li-Ion battery, capturing three distinct regions. Initially, there's a
rapid voltage drop, termed the exponential region, followed by the
nominal region, where voltage stabilizes, offering consistent power
output. Finally, the voltage sharply decreases to the cut-off point,
indicating the battery's minimum usable limit to prevent damage. The
horizontal axis measures the battery's storage capacity in Ampere-hours
(Ah), marking the top, nominal, and maximum capacity, respectively, with
a steep voltage decline signifying depletion and the need for
recharging.

<figure style="text-align: center;">
  <img src="figures/battery_discharge_curve.png">
  <figcaption>Fig. 15: Typical discharge curve of a
battery
</figcaption>
</figure>

We use a model incorporating polarization voltage as a time-dependent
state variable, accounting for variations in output voltage
[@tremblay2009experimental]. The discharge voltage is estimated using
the following equation:

$$\begin{aligned}
    V_{\mathrm{B}} = & \underbrace{V_{\mathrm{C}}-R_{\mathrm{B}} I_{\mathrm{B}}}_{\text{Equivalent circuit}} \notag \\
    & - \underbrace{K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}}-\int_{L_{\mathrm{1}}}^{t_2} \frac{I_{\mathrm{n}}}{3650} \mathrm{d} t}\left(\int_{t_1}^{t_2} \frac{I_{\mathrm{B}}}{3600} \mathrm{d} t+I_{\mathrm{F}}\right)}_{\text{Polarization}}  \notag \\
    & + \underbrace{A \exp \left(-B \int_{t_1}^{t_2} \frac{I_{\mathrm{B}}}{3600} \mathrm{d} t\right)}_{\text{Exponential}}
\end{aligned}$$

Here, $A$ is the amplitude of the exponential zone (V), $B$ is the
inverse time constant, $Q_{\mathrm{N}}$ is the nominal battery capacity
(Ah), $R_{\mathrm{B}}$ is the internal resistance ($\Omega$), $K$ is the
polarization constant, $V_{\mathrm{C}}$ is the battery's constant
voltage, and $V_{\mathrm{B}}$ is the terminal voltage. $I_{\mathrm{F}}$
and $I_{\mathrm{B}}$ denote the filtered and battery currents,
respectively. The coefficients $A$ and $B$ are defined as follows:

$$A=V_{\mathrm{F}}-V_{\mathrm{C}}+R_{\mathrm{B}} I_{\mathrm{B}}, \quad B=\frac{3}{Q_{\mathrm{E}}}$$
To determine the polarization constant $K$, we use the following
equation, considering maximum charge ($Q_{max}$), nominal charge
($Q_{N}$), and other battery parameters:

$$K = -\frac{\left(Q_{\max} - Q_{\mathrm{N}}\right) \left[V_{\mathrm{N}} - V_{\mathrm{C}} + R_{\mathrm{B}} I_{\mathrm{B}} - A \exp \left(-B Q_{\mathrm{N}}\right)\right]}{Q_{\max} \left(Q_{\mathrm{N}} + I_{\mathrm{B}}\right)}$$

We estimate the SoC using the following expression:

$$\mathrm{SoC} = \frac{Q_{\max} - \int_{t_1}^{t_2} \frac{I_{\mathrm{B}}}{3600} \mathrm{d} t}{Q_{\max}} \times 100%$$

Regarding the physical arrangement of batteries, they can be configured
in either series-parallel or parallel-series connections to achieve the
desired pack voltage and current. The total pack voltage ($V_{pack}$)
and current ($I_{pack}$) can be calculated as follows, where $N_S$ and
$N_P$ are the numbers of series and parallel connections, respectively:

$$\begin{aligned}
    V_{\mathrm{pack}} & = V_{\mathrm{B}} N_{\mathrm{S}}\\
    I_{\mathrm{pack}} & = I_{\mathrm{B}} N_{\mathrm{P}}
\end{aligned}$$


### Battery Chemistry Models and Parameters

| **Chemistry** | **Voltage ($V_B$)** | **Model** |
|--------------|---------------------|-----------|
| **Lead-Acid** | **Discharge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_B}\left(Q_B + I_{\mathrm{F}}\right) + V_{\mathrm{exp}}(t)$ |
| | **Charge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{B}} - 0.1 \cdot Q_N}I_{\mathrm{F}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_{\mathrm{B}}}Q_{\mathrm{B}} + V_{\mathrm{exp}}(t)$ |
| **Li-Ion** | **Discharge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_B}\left(Q_B + I_{\mathrm{F}}\right) + A \exp \left(-B Q_B\right)$ |
| | **Charge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{B}} - 0.1 \cdot Q_N}I_{\mathrm{F}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_{\mathrm{B}}}Q_{\mathrm{B}} + A \exp \left(-B Q_B\right)$ |
| **NiMH & NiCd** | **Discharge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_B}\left(Q_B + I_{\mathrm{F}}\right) + V_{\mathrm{exp}}(t)$ |
| | **Charge** | $V_{\mathrm{EC}} - K \frac{Q_{\mathrm{N}}}{|Q_{\mathrm{B}}| - 0.1 \cdot Q_N}I_{\mathrm{F}} - K \frac{Q_{\mathrm{N}}}{Q_{\mathrm{N}} - Q_{\mathrm{B}}}Q_{\mathrm{B}} + V_{\mathrm{exp}}(t)$ |


### Equations

The discharge quantity \( Q_B \) is calculated as:

$$Q_B = \int_{t_1}^{t_2} \frac{I_{\mathrm{B}}}{3600} \mathrm{~d} t$$

The voltage in the exponential zone $V_{\mathrm{exp}}(t)$ is given by:

$$V_{\mathrm{EC}} = V_{\mathrm{C}}-R_{\mathrm{B}} I_{\mathrm{B}}$$

### Battery Parameters

| Type       | Lead-Acid          | NiCd              | Li-Ion            | NiMH             |
|------------|--------------------|-------------------|-------------------|------------------|
| Parameters | 12V, 7.2Ah         | 1.2V, 2.3Ah       | 3.3V, 2.3Ah       | 1.2V, 6.5Ah      |
| $V_C$ [V]  | 12.466             | 1.2705            | 3.366             | 1.2816           |
| $R_B$ [$\omega$]  | 0.04               | 0.003             | 0.01              | 0.002            |
| $K$ [$\omega$]    | 0.047              | 0.0037            | 0.0076            | 0.0014           |
| $A$ [V]    | 0.83               | 0.127             | 0.26422           | 0.111            |
| $B$ [A h\(^{-1}\)] | 125           | 4.98              | 26.5487           | 2.3077           |

*Battery Parameters*

